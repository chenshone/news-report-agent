#!/usr/bin/env python3
"""
è¿½è¸ªå™¨æµ‹è¯•è„šæœ¬ - æ¨¡æ‹Ÿ Agent æ‰§è¡Œæµç¨‹

æ— éœ€è°ƒç”¨çœŸå® LLMï¼Œå¿«é€ŸéªŒè¯è¿½è¸ªåŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚

ä½¿ç”¨æ–¹å¼:
    uv run python -m scripts.test_tracer
    uv run python -m scripts.test_tracer --output ./test_trace.html
"""

import argparse
import sys
import time
import random
from pathlib import Path

# ç¡®ä¿é¡¹ç›®æ ¹ç›®å½•åœ¨ path ä¸­
sys.path.insert(0, str(Path(__file__).parent.parent))

from rich.console import Console

from src.utils.tracer import (
    AgentTracer,
    RichAgentCallback,
    EventType,
    generate_html_report,
)


console = Console()


def simulate_llm_call(callback: RichAgentCallback, model: str, prompt: str, response: str, duration_ms: int = 1000):
    """æ¨¡æ‹Ÿ LLM è°ƒç”¨"""
    from uuid import uuid4
    run_id = uuid4()
    
    # æ¨¡æ‹Ÿ on_llm_start
    callback.on_llm_start(
        serialized={"kwargs": {"model": model}},
        prompts=[prompt],
        run_id=run_id,
    )
    
    # æ¨¡æ‹Ÿè€—æ—¶
    time.sleep(duration_ms / 1000)
    
    # æ¨¡æ‹Ÿ on_llm_end
    from langchain_core.outputs import LLMResult, Generation
    result = LLMResult(generations=[[Generation(text=response)]])
    callback.on_llm_end(result, run_id=run_id)


def simulate_tool_call(callback: RichAgentCallback, tool_name: str, input_str: str, output: str, duration_ms: int = 500):
    """æ¨¡æ‹Ÿå·¥å…·è°ƒç”¨"""
    from uuid import uuid4
    run_id = uuid4()
    
    # æ¨¡æ‹Ÿ on_tool_start
    callback.on_tool_start(
        serialized={"name": tool_name},
        input_str=input_str,
        run_id=run_id,
    )
    
    # æ¨¡æ‹Ÿè€—æ—¶
    time.sleep(duration_ms / 1000)
    
    # æ¨¡æ‹Ÿ on_tool_end
    callback.on_tool_end(output, run_id=run_id)


def simulate_agent_workflow(callback: RichAgentCallback):
    """æ¨¡æ‹Ÿå®Œæ•´çš„ Agent å·¥ä½œæµç¨‹"""
    console.print("\n[bold cyan]ğŸš€ å¼€å§‹æ¨¡æ‹Ÿ Agent æ‰§è¡Œæµç¨‹...[/]\n")
    
    # 1. Master Agent æ¥æ”¶ä»»åŠ¡
    simulate_llm_call(
        callback,
        model="gpt-4o",
        prompt="ç”¨æˆ·è¯·æ±‚: åˆ†æä»Šå¤©AIé¢†åŸŸçš„æœ€æ–°è¿›å±•",
        response="æˆ‘éœ€è¦å…ˆè°ƒç”¨ query_planner æ¥è§„åˆ’æœç´¢æŸ¥è¯¢ï¼Œç”Ÿæˆå¤šç»´åº¦çš„æœç´¢ç­–ç•¥ã€‚",
        duration_ms=200,
    )
    
    # 2. è°ƒç”¨ query_planner å­Agent
    simulate_llm_call(
        callback,
        model="gpt-4o",
        prompt="""ä½ æ˜¯æŸ¥è¯¢è§„åˆ’ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®ç”¨æˆ·éœ€æ±‚ç”Ÿæˆé«˜è´¨é‡çš„æœç´¢æŸ¥è¯¢ã€‚

## å·¥ä½œæµç¨‹

### 1. æ„å›¾åˆ†æ
ç†è§£ç”¨æˆ·æƒ³äº†è§£ä»€ä¹ˆï¼š
- å…³æ³¨çš„é¢†åŸŸæˆ–ä¸»é¢˜
- æ—¶é—´èŒƒå›´ï¼ˆä»Šå¤©ã€è¿‘æœŸã€ç‰¹å®šæ—¥æœŸï¼‰
- å…³æ³¨ç‚¹ï¼ˆæŠ€æœ¯ã€å¸‚åœºã€æ”¿ç­–ã€ç”¨æˆ·åé¦ˆç­‰ï¼‰

### 2. æŸ¥è¯¢ç”Ÿæˆ
ç”Ÿæˆ 3-5 ä¸ªä¸åŒè§’åº¦çš„æœç´¢æŸ¥è¯¢ã€‚

ç”¨æˆ·éœ€æ±‚: åˆ†æä»Šå¤©AIé¢†åŸŸçš„æœ€æ–°è¿›å±•""",
        response='''{
  "queries": [
    {"query": "AI 2024å¹´12æœˆ17æ—¥ æœ€æ–°è¿›å±• latest news", "purpose": "æ ¸å¿ƒæŠ€æœ¯è¿›å±•ï¼ˆå½“æ—¥ï¼‰", "priority": "high"},
    {"query": "OpenAI ChatGPT Anthropic Claude 2024å¹´12æœˆ æ›´æ–°", "purpose": "å¤§å‚äº§å“åŠ¨æ€", "priority": "high"},
    {"query": "AI åˆ›ä¸šå…¬å¸ èèµ„ æ–°é—» 2024", "purpose": "è¡Œä¸šæŠ•èµ„åŠ¨æ€", "priority": "medium"}
  ],
  "reflection": "æŸ¥è¯¢è¦†ç›–äº†æŠ€æœ¯è¿›å±•ã€å¤§å‚åŠ¨æ€ã€å•†ä¸šèèµ„ä¸‰ä¸ªç»´åº¦ã€‚",
  "adjustment_suggestions": "å¦‚æœæŠ€æœ¯ç±»ç»“æœè¾ƒå°‘ï¼Œå¯è¡¥å……æŸ¥è¯¢ 'AI arxiv è®ºæ–‡ 12æœˆ'"
}''',
        duration_ms=300,
    )
    
    # 3. è°ƒç”¨æœç´¢å·¥å…·
    simulate_tool_call(
        callback,
        tool_name="internet_search",
        input_str='{"query": "AI 2024å¹´12æœˆ17æ—¥ æœ€æ–°è¿›å±• latest news", "max_results": 10}',
        output='''[
  {"title": "OpenAIå‘å¸ƒGPT-5é¢„è§ˆç‰ˆ", "url": "https://openai.com/blog/gpt-5-preview", "snippet": "OpenAIä»Šæ—¥å®£å¸ƒGPT-5é¢„è§ˆç‰ˆå¼€å§‹å†…æµ‹ï¼Œæ–°æ¨¡å‹åœ¨æ¨ç†èƒ½åŠ›ä¸Šæœ‰æ˜¾è‘—æå‡ã€‚"},
  {"title": "Google Gemini 2.0å‘å¸ƒ", "url": "https://blog.google/gemini-2", "snippet": "Googleå‘å¸ƒGemini 2.0ï¼Œæ”¯æŒå¤šæ¨¡æ€åŸç”Ÿæ¨ç†ï¼Œæ€§èƒ½å…¨é¢è¶…è¶Šå‰ä»£ã€‚"},
  {"title": "Anthropicè·å¾—æ–°ä¸€è½®èèµ„", "url": "https://techcrunch.com/anthropic-funding", "snippet": "Anthropicå®Œæˆ20äº¿ç¾å…ƒèèµ„ï¼Œä¼°å€¼è¾¾600äº¿ç¾å…ƒã€‚"}
]''',
        duration_ms=400,
    )
    
    # 4. è°ƒç”¨ fetch_page å·¥å…·
    simulate_tool_call(
        callback,
        tool_name="fetch_page",
        input_str='{"url": "https://openai.com/blog/gpt-5-preview"}',
        output='''# GPT-5 é¢„è§ˆç‰ˆå‘å¸ƒå…¬å‘Š

OpenAIä»Šå¤©æ­£å¼å®£å¸ƒGPT-5é¢„è§ˆç‰ˆå¼€å§‹å†…æµ‹ã€‚è¿™æ˜¯æˆ‘ä»¬è¿„ä»Šä¸ºæ­¢æœ€å¼ºå¤§çš„è¯­è¨€æ¨¡å‹ã€‚

## ä¸»è¦æ”¹è¿›

1. **æ¨ç†èƒ½åŠ›æå‡300%** - åœ¨å¤æ‚æ•°å­¦å’Œç¼–ç¨‹ä»»åŠ¡ä¸Šè¡¨ç°å¤§å¹…æå‡
2. **ä¸Šä¸‹æ–‡çª—å£æ‰©å±•è‡³200K tokens** - å¯ä»¥å¤„ç†æ›´é•¿çš„æ–‡æ¡£å’Œå¯¹è¯
3. **å¤šæ¨¡æ€åŸç”Ÿæ”¯æŒ** - å›¾åƒã€éŸ³é¢‘ã€è§†é¢‘çš„ç†è§£å’Œç”Ÿæˆèƒ½åŠ›
4. **å®æ—¶è”ç½‘èƒ½åŠ›** - å¯ä»¥è®¿é—®æœ€æ–°çš„äº’è”ç½‘ä¿¡æ¯

## å†…æµ‹è®¡åˆ’

é¦–æ‰¹å†…æµ‹å°†é¢å‘ChatGPT Plusç”¨æˆ·å¼€æ”¾ï¼Œé¢„è®¡2025å¹´Q1å…¨é¢å‘å¸ƒã€‚

## å®‰å…¨æªæ–½

æˆ‘ä»¬æŠ•å…¥äº†å¤§é‡èµ„æºç¡®ä¿æ¨¡å‹çš„å®‰å…¨æ€§ï¼ŒåŒ…æ‹¬ï¼š
- çº¢é˜Ÿæµ‹è¯•è¶…è¿‡1000å°æ—¶
- ä¸å¤–éƒ¨å®‰å…¨ç ”ç©¶æœºæ„åˆä½œå®¡è®¡
- å¼ºåŒ–çš„å†…å®¹è¿‡æ»¤ç³»ç»Ÿ''',
        duration_ms=300,
    )
    
    # 5. è°ƒç”¨ summarizer å­Agent
    simulate_llm_call(
        callback,
        model="gpt-4o-mini",
        prompt="""ä½ æ˜¯æ‘˜è¦ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯æå–æ–°é—»æ–‡ç« çš„æ ¸å¿ƒè¦ç‚¹ï¼Œç”Ÿæˆç»“æ„åŒ–æ‘˜è¦ã€‚

## å·¥ä½œæµç¨‹

1. **å¿«é€Ÿæµè§ˆ**ï¼šç†è§£æ–‡ç« ä¸»é¢˜å’Œç»“æ„
2. **æå–è¦ç‚¹**ï¼šè¯†åˆ« 3-5 ä¸ªæ ¸å¿ƒè¦ç‚¹
3. **è¯†åˆ«å…³é”®ä¿¡æ¯**ï¼š
   - å…³é”®æ•°æ®ï¼ˆæ•°å­—ã€ç™¾åˆ†æ¯”ã€é‡‘é¢ç­‰ï¼‰
   - é‡è¦äººç‰©ï¼ˆå§“åã€èŒä½ï¼‰
   - å…³é”®æ—¶é—´ï¼ˆå‘å¸ƒæ—¶é—´ã€äº‹ä»¶æ—¶é—´ï¼‰

## å¾…æ‘˜è¦å†…å®¹

# GPT-5 é¢„è§ˆç‰ˆå‘å¸ƒå…¬å‘Š

OpenAIä»Šå¤©æ­£å¼å®£å¸ƒGPT-5é¢„è§ˆç‰ˆå¼€å§‹å†…æµ‹ã€‚è¿™æ˜¯æˆ‘ä»¬è¿„ä»Šä¸ºæ­¢æœ€å¼ºå¤§çš„è¯­è¨€æ¨¡å‹ã€‚

## ä¸»è¦æ”¹è¿›
1. æ¨ç†èƒ½åŠ›æå‡300%
2. ä¸Šä¸‹æ–‡çª—å£æ‰©å±•è‡³200K tokens
3. å¤šæ¨¡æ€åŸç”Ÿæ”¯æŒ
4. å®æ—¶è”ç½‘èƒ½åŠ›

## å†…æµ‹è®¡åˆ’
é¦–æ‰¹å†…æµ‹å°†é¢å‘ChatGPT Plusç”¨æˆ·å¼€æ”¾ï¼Œé¢„è®¡2025å¹´Q1å…¨é¢å‘å¸ƒã€‚""",
        response="""### æ ¸å¿ƒè¦ç‚¹
1. OpenAIå‘å¸ƒGPT-5é¢„è§ˆç‰ˆï¼Œå¼€å§‹å†…æµ‹é˜¶æ®µ
2. æ¨ç†èƒ½åŠ›æå‡300%ï¼Œåœ¨æ•°å­¦å’Œç¼–ç¨‹ä»»åŠ¡ä¸Šè¡¨ç°å¤§å¹…æå‡
3. ä¸Šä¸‹æ–‡çª—å£æ‰©å±•è‡³200K tokensï¼Œå¯å¤„ç†æ›´é•¿æ–‡æ¡£
4. æ–°å¢å¤šæ¨¡æ€åŸç”Ÿæ”¯æŒå’Œå®æ—¶è”ç½‘èƒ½åŠ›
5. é¢„è®¡2025å¹´Q1å…¨é¢å‘å¸ƒ

### å…³é”®ä¿¡æ¯
- **å…³é”®æ•°æ®**ï¼šæ¨ç†èƒ½åŠ›æå‡300%ï¼Œä¸Šä¸‹æ–‡200K tokens
- **é‡è¦æ—¶é—´**ï¼š2025å¹´Q1å…¨é¢å‘å¸ƒ
- **ç›®æ ‡ç”¨æˆ·**ï¼šé¦–æ‰¹é¢å‘ChatGPT Plusç”¨æˆ·

### ä¸€å¥è¯æ€»ç»“
OpenAIå‘å¸ƒGPT-5é¢„è§ˆç‰ˆï¼Œæ¨ç†èƒ½åŠ›æå‡300%ï¼Œæ”¯æŒ200Kä¸Šä¸‹æ–‡å’Œå¤šæ¨¡æ€ï¼Œé¢„è®¡2025å¹´Q1å…¨é¢å‘å¸ƒã€‚""",
        duration_ms=250,
    )
    
    # 6. è°ƒç”¨ fact_checker å­Agent
    simulate_llm_call(
        callback,
        model="gpt-4o-mini",
        prompt="""ä½ æ˜¯äº‹å®æ ¸æŸ¥ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯æ ¸æŸ¥æ–‡ç« ä¸­çš„å…³é”®äº‹å®å£°æ˜ã€‚

## å¾…æ ¸æŸ¥å£°æ˜
1. GPT-5æ¨ç†èƒ½åŠ›æå‡300%
2. ä¸Šä¸‹æ–‡çª—å£200K tokens
3. 2025å¹´Q1å…¨é¢å‘å¸ƒ""",
        response="""### äº‹å®æ ¸æŸ¥ç»“æœ

#### å£°æ˜ 1: GPT-5æ¨ç†èƒ½åŠ›æå‡300%
- **çŠ¶æ€**: âš ï¸ éƒ¨åˆ†éªŒè¯
- **éªŒè¯ä¾æ®**: OpenAIå®˜æ–¹åšå®¢å£°ç§°ï¼Œä½†å…·ä½“åŸºå‡†æµ‹è¯•æ•°æ®å°šæœªå…¬å¼€
- **ç½®ä¿¡åº¦**: ä¸­

#### å£°æ˜ 2: ä¸Šä¸‹æ–‡çª—å£200K tokens
- **çŠ¶æ€**: âœ… å·²éªŒè¯
- **éªŒè¯ä¾æ®**: å®˜æ–¹æŠ€æœ¯æ–‡æ¡£ç¡®è®¤
- **ç½®ä¿¡åº¦**: é«˜

#### å£°æ˜ 3: 2025å¹´Q1å…¨é¢å‘å¸ƒ
- **çŠ¶æ€**: âœ… å·²éªŒè¯
- **éªŒè¯ä¾æ®**: OpenAIå®˜æ–¹å…¬å‘Šæ˜ç¡®è¯´æ˜
- **ç½®ä¿¡åº¦**: é«˜

### æ€»ä½“è¯„ä¼°
- **å¯ä¿¡åº¦**: ä¸­é«˜
- **å»ºè®®**: å…³äºæ€§èƒ½æå‡æ•°æ®å»ºè®®ç­‰å¾…ç‹¬ç«‹åŸºå‡†æµ‹è¯•éªŒè¯""",
        duration_ms=200,
    )
    
    # 7. è°ƒç”¨ researcher å­Agent  
    simulate_llm_call(
        callback,
        model="gpt-4o-mini",
        prompt="""ä½ æ˜¯èƒŒæ™¯ç ”ç©¶ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯ä¸ºæ–°é—»æä¾›æ·±åº¦èƒŒæ™¯ä¿¡æ¯å’Œä¸Šä¸‹æ–‡ã€‚

ä¸»é¢˜: OpenAI GPT-5å‘å¸ƒ""",
        response="""### èƒŒæ™¯ä¿¡æ¯

#### å†å²è„‰ç»œ
OpenAIæˆç«‹äº2015å¹´ï¼Œç”±Sam Altmanã€Elon Muskç­‰äººè”åˆåˆ›ç«‹ã€‚å…¬å¸è‡´åŠ›äºå¼€å‘å®‰å…¨çš„é€šç”¨äººå·¥æ™ºèƒ½ã€‚

#### ç›¸å…³äº‹ä»¶æ—¶é—´çº¿
- 2018-06: GPT-1å‘å¸ƒï¼Œ1.17äº¿å‚æ•°
- 2019-02: GPT-2å‘å¸ƒï¼Œ15äº¿å‚æ•°
- 2020-06: GPT-3å‘å¸ƒï¼Œ1750äº¿å‚æ•°
- 2023-03: GPT-4å‘å¸ƒï¼Œå‚æ•°è§„æ¨¡æœªå…¬å¼€
- 2024-12: GPT-5é¢„è§ˆç‰ˆå‘å¸ƒ

#### å…³é”®æ¦‚å¿µè§£é‡Š
- **ä¸Šä¸‹æ–‡çª—å£**: æ¨¡å‹ä¸€æ¬¡èƒ½å¤„ç†çš„æœ€å¤§tokenæ•°é‡ï¼Œå†³å®šäº†å¯ä»¥è¾“å…¥å¤šé•¿çš„æ–‡æœ¬
- **å¤šæ¨¡æ€**: åŒæ—¶å¤„ç†æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ç­‰å¤šç§ç±»å‹æ•°æ®çš„èƒ½åŠ›

#### ç«äº‰æ ¼å±€
GPT-5å‘å¸ƒä½¿OpenAIä¸Google (Gemini)ã€Anthropic (Claude) çš„ç«äº‰è¿›ä¸€æ­¥å‡çº§ã€‚

### å‚è€ƒæ¥æº
- OpenAIå®˜æ–¹åšå®¢
- TechCrunchç§‘æŠ€æŠ¥é“""",
        duration_ms=180,
    )
    
    # 8. è¡¥å……æœç´¢
    simulate_tool_call(
        callback,
        tool_name="internet_search",
        input_str='{"query": "OpenAI èèµ„ ä¼°å€¼ 2024"}',
        output='''[
  {"title": "OpenAIä¼°å€¼è¾¾1500äº¿ç¾å…ƒ", "url": "https://reuters.com/openai-valuation", "snippet": "æ®è·¯é€ç¤¾æŠ¥é“ï¼ŒOpenAIæœ€æ–°ä¸€è½®èèµ„åä¼°å€¼è¾¾åˆ°1500äº¿ç¾å…ƒï¼Œæˆä¸ºå…¨çƒä¼°å€¼æœ€é«˜çš„AIåˆ›ä¸šå…¬å¸ã€‚"}
]''',
        duration_ms=350,
    )
    
    # 9. è°ƒç”¨ impact_assessor å­Agent
    simulate_llm_call(
        callback,
        model="gpt-4o-mini",
        prompt="""ä½ æ˜¯å½±å“è¯„ä¼°ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯è¯„ä¼°æ–°é—»äº‹ä»¶çš„æ½œåœ¨å½±å“å’Œæœªæ¥å‘å±•ã€‚

äº‹ä»¶: OpenAIå‘å¸ƒGPT-5é¢„è§ˆç‰ˆ""",
        response="""### å½±å“è¯„ä¼°

#### çŸ­æœŸå½±å“ï¼ˆ1-3 ä¸ªæœˆï¼‰
- **æŠ€æœ¯å±‚é¢**: æ¨åŠ¨è¡Œä¸šæŠ€æœ¯æ ‡å‡†æå‡ï¼Œç«äº‰å¯¹æ‰‹å¯èƒ½åŠ é€Ÿå‘å¸ƒæ–°äº§å“
- **å•†ä¸šå±‚é¢**: ChatGPTè®¢é˜…ç”¨æˆ·å¯èƒ½å¤§å¹…å¢é•¿ï¼Œä¼ä¸šAPIéœ€æ±‚å¢åŠ 
- **ç”¨æˆ·å±‚é¢**: Plusç”¨æˆ·è·å¾—å†…æµ‹èµ„æ ¼ï¼Œæ™®é€šç”¨æˆ·éœ€ç­‰å¾…

#### ä¸­æœŸå½±å“ï¼ˆ3-12 ä¸ªæœˆï¼‰
- AIåº”ç”¨å¼€å‘è€…å°†åŸºäºGPT-5æ„å»ºæ›´å¼ºå¤§çš„åº”ç”¨
- å¯èƒ½å¼•å‘æ–°ä¸€è½®AIäººæ‰äº‰å¤ºæˆ˜
- ç›‘ç®¡æœºæ„å¯èƒ½åŠ å¼ºå¯¹é«˜èƒ½åŠ›AIç³»ç»Ÿçš„å®¡æŸ¥

#### é•¿æœŸå½±å“ï¼ˆ1 å¹´ä»¥ä¸Šï¼‰
- æ¨åŠ¨é€šç”¨äººå·¥æ™ºèƒ½(AGI)ç ”ç©¶è¿›å±•
- æ”¹å˜çŸ¥è¯†å·¥ä½œè€…çš„å·¥ä½œæ–¹å¼
- å¯èƒ½å‚¬ç”Ÿæ–°çš„äº§ä¸šå’Œå°±ä¸šå½¢æ€

### å‘å±•è¶‹åŠ¿é¢„æµ‹
AIå¤§æ¨¡å‹ç«èµ›å°†ç»§ç»­å‡çº§ï¼Œé¢„è®¡2025å¹´å°†çœ‹åˆ°æ›´å¤šçªç ´æ€§è¿›å±•ã€‚

### ä¸ç¡®å®šæ€§åˆ†æ
- **ç¡®å®šæ€§é«˜**: æŠ€æœ¯ç«äº‰åŠ å‰§ã€ç”¨æˆ·å¢é•¿
- **å­˜åœ¨å˜æ•°**: ç›‘ç®¡æ”¿ç­–ã€å®‰å…¨é—®é¢˜ã€å•†ä¸šåŒ–é€Ÿåº¦
- **å…³é”®å› ç´ **: GPT-5å®é™…è¡¨ç°æ˜¯å¦ç¬¦åˆé¢„æœŸ

### å»ºè®®å…³æ³¨ç‚¹
1. GPT-5æ­£å¼å‘å¸ƒåçš„ç”¨æˆ·åé¦ˆ
2. ç«äº‰å¯¹æ‰‹çš„åº”å¯¹ç­–ç•¥
3. ç›‘ç®¡æ”¿ç­–åŠ¨å‘""",
        duration_ms=220,
    )
    
    # 10. è°ƒç”¨ expert_supervisor å­Agent
    simulate_llm_call(
        callback,
        model="gpt-4o",
        prompt="""ä½ æ˜¯ä¸“å®¶ä¸»ç®¡ã€‚ä½ çš„ä»»åŠ¡æ˜¯å®¡æ ¸å„ä¸“å®¶çš„åˆ†æç»“æœï¼Œåè°ƒè®¨è®ºï¼Œç¡®ä¿æœ€ç»ˆè¾“å‡ºçš„è´¨é‡ã€‚

è¯·å®¡æ ¸ä»¥ä¸‹å†…å®¹ï¼š
- summarizer: æ ¸å¿ƒè¦ç‚¹æ‘˜è¦
- fact_checker: äº‹å®æ ¸æŸ¥ç»“æœ  
- researcher: èƒŒæ™¯ç ”ç©¶
- impact_assessor: å½±å“è¯„ä¼°""",
        response="""## å®¡æ ¸ç»“æœï¼šé€šè¿‡

### æ•´ä½“è¯„ä»·
å„ä¸“å®¶çš„åˆ†æå·²è¾¾åˆ°å‘å¸ƒæ ‡å‡†ï¼Œä¿¡æ¯å‡†ç¡®ã€é€»è¾‘æ¸…æ™°ã€å†…å®¹å®Œæ•´ã€‚

### å…³é”®å‘ç°
1. GPT-5æ˜¯OpenAIè¿„ä»Šæœ€å¼ºå¤§çš„æ¨¡å‹ï¼Œæ¨ç†èƒ½åŠ›å¤§å¹…æå‡
2. 200Kä¸Šä¸‹æ–‡çª—å£å’Œå¤šæ¨¡æ€æ”¯æŒæ˜¯é‡è¦æŠ€æœ¯çªç ´
3. 2025å¹´Q1å…¨é¢å‘å¸ƒçš„æ—¶é—´è¡¨æ˜ç¡®

### å»ºè®®å¼ºè°ƒ
åœ¨æœ€ç»ˆæŠ¥å‘Šä¸­å»ºè®®å¼ºè°ƒï¼š
- GPT-5çš„æ ¸å¿ƒæŠ€æœ¯çªç ´ï¼ˆæ¨ç†èƒ½åŠ›ã€ä¸Šä¸‹æ–‡é•¿åº¦ï¼‰
- å¯¹è¡Œä¸šç«äº‰æ ¼å±€çš„å½±å“
- ç”¨æˆ·è·å–é€”å¾„å’Œæ—¶é—´è¡¨

### é£é™©æç¤º
éœ€è¦åœ¨æŠ¥å‘Šä¸­æç¤ºçš„é£é™©ï¼š
- æ€§èƒ½æå‡æ•°æ®å°šæœªç»è¿‡ç‹¬ç«‹éªŒè¯
- å®é™…å‘å¸ƒæ—¶é—´å¯èƒ½æœ‰å˜åŠ¨

### æ‰¹å‡†
æ‰€æœ‰ä¸“å®¶åˆ†æå·²å®¡æ ¸é€šè¿‡ï¼Œå¯ä»¥è¿›å…¥æŠ¥å‘Šç”Ÿæˆé˜¶æ®µã€‚""",
        duration_ms=280,
    )
    
    # 11. Master Agent ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š
    simulate_llm_call(
        callback,
        model="gpt-4o",
        prompt="è¯·æ•´åˆå„ä¸“å®¶åˆ†æï¼Œç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š",
        response="""# AIé¢†åŸŸæœ€æ–°è¿›å±•æŠ¥å‘Š

## æ¦‚è¿°
2024å¹´12æœˆ17æ—¥ï¼ŒOpenAIæ­£å¼å®£å¸ƒGPT-5é¢„è§ˆç‰ˆå¼€å§‹å†…æµ‹ï¼Œè¿™æ ‡å¿—ç€å¤§è¯­è¨€æ¨¡å‹æŠ€æœ¯è¿›å…¥æ–°é˜¶æ®µã€‚

## æ ¸å¿ƒè¦ç‚¹

### 1. æŠ€æœ¯çªç ´
- **æ¨ç†èƒ½åŠ›æå‡300%**ï¼šåœ¨å¤æ‚æ•°å­¦å’Œç¼–ç¨‹ä»»åŠ¡ä¸Šè¡¨ç°å¤§å¹…æå‡
- **ä¸Šä¸‹æ–‡çª—å£200K tokens**ï¼šå¯å¤„ç†çº¦15ä¸‡å­—çš„é•¿æ–‡æ¡£
- **å¤šæ¨¡æ€åŸç”Ÿæ”¯æŒ**ï¼šå›¾åƒã€éŸ³é¢‘ã€è§†é¢‘çš„ç†è§£å’Œç”Ÿæˆèƒ½åŠ›
- **å®æ—¶è”ç½‘èƒ½åŠ›**ï¼šå¯è®¿é—®æœ€æ–°äº’è”ç½‘ä¿¡æ¯

### 2. å‘å¸ƒè®¡åˆ’
- é¦–æ‰¹å†…æµ‹ï¼šé¢å‘ChatGPT Plusç”¨æˆ·
- å…¨é¢å‘å¸ƒï¼šé¢„è®¡2025å¹´Q1

### 3. è¡Œä¸šå½±å“
- çŸ­æœŸï¼šç«äº‰å¯¹æ‰‹å¯èƒ½åŠ é€Ÿäº§å“å‘å¸ƒ
- ä¸­æœŸï¼šæ¨åŠ¨AIåº”ç”¨ç”Ÿæ€å‘å±•
- é•¿æœŸï¼šåŠ é€ŸAGIç ”ç©¶è¿›ç¨‹

## äº‹å®æ ¸æŸ¥
- âœ… 200Kä¸Šä¸‹æ–‡çª—å£ï¼šå·²éªŒè¯
- âœ… 2025å¹´Q1å‘å¸ƒï¼šå·²éªŒè¯
- âš ï¸ æ€§èƒ½æå‡300%ï¼šå¾…ç‹¬ç«‹éªŒè¯

## èƒŒæ™¯
OpenAI GPTç³»åˆ—å‘å±•å†ç¨‹ï¼šGPT-1(2018) â†’ GPT-2(2019) â†’ GPT-3(2020) â†’ GPT-4(2023) â†’ GPT-5(2024)

## å»ºè®®å…³æ³¨
1. GPT-5æ­£å¼å‘å¸ƒåçš„å®é™…è¡¨ç°
2. Googleã€Anthropicç­‰ç«äº‰å¯¹æ‰‹çš„åº”å¯¹
3. AIç›‘ç®¡æ”¿ç­–åŠ¨å‘

---
*æŠ¥å‘Šç”Ÿæˆæ—¶é—´ï¼š2024å¹´12æœˆ17æ—¥*
*æ•°æ®æ¥æºï¼šOpenAIå®˜æ–¹åšå®¢ã€TechCrunchã€Reuters*""",
        duration_ms=350,
    )
    
    console.print("\n[bold green]âœ… æ¨¡æ‹Ÿæ‰§è¡Œå®Œæˆï¼[/]\n")


def main():
    parser = argparse.ArgumentParser(description="è¿½è¸ªå™¨æµ‹è¯•è„šæœ¬")
    parser.add_argument("--output", "-o", type=str, help="è¾“å‡º HTML æŠ¥å‘Šè·¯å¾„")
    parser.add_argument("--json", type=str, help="è¾“å‡º JSON æ•°æ®è·¯å¾„")
    args = parser.parse_args()
    
    # åˆ›å»ºè¿½è¸ªå™¨å’Œå›è°ƒ
    tracer = AgentTracer(session_name="test-simulation")
    callback = RichAgentCallback(
        tracer=tracer,
        show_input=True,
        show_output=True,
    )
    
    # è¿è¡Œæ¨¡æ‹Ÿ
    simulate_agent_workflow(callback)
    
    # æ‰“å°æ‘˜è¦
    callback.print_summary()
    
    # ä¿å­˜æŠ¥å‘Š
    if args.output:
        output_path = Path(args.output)
        output_path.parent.mkdir(parents=True, exist_ok=True)
        tracer.export_html(str(output_path))
        console.print(f"\n[bold green]ğŸ“Š HTML æŠ¥å‘Šå·²ä¿å­˜åˆ°: {output_path}[/]")
    
    if args.json:
        json_path = Path(args.json)
        json_path.parent.mkdir(parents=True, exist_ok=True)
        tracer.export_json(str(json_path))
        console.print(f"\n[bold green]ğŸ“„ JSON æ•°æ®å·²ä¿å­˜åˆ°: {json_path}[/]")
    
    # å¦‚æœæ²¡æœ‰æŒ‡å®šè¾“å‡ºï¼Œé»˜è®¤ç”Ÿæˆåˆ° reports ç›®å½•
    if not args.output and not args.json:
        default_html = Path("./reports/test_trace.html")
        default_html.parent.mkdir(parents=True, exist_ok=True)
        tracer.export_html(str(default_html))
        console.print(f"\n[dim]ğŸ’¡ æç¤º: HTML æŠ¥å‘Šå·²ä¿å­˜åˆ° {default_html}[/]")
        console.print(f"[dim]   ç”¨æµè§ˆå™¨æ‰“å¼€æŸ¥çœ‹å¯è§†åŒ–æ•ˆæœ[/]")


if __name__ == "__main__":
    main()

